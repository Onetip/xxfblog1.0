<extend name="Public/base" />
<block name="main">
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-lg-10 col-lg-push-1 message">
                    <div class="message-text clearfix">
                        <textarea class="form-control has-error" rows="3" id="content"></textarea>
                        <div class="form-inline">
                            <div class="form-group">
                                <input type="text" class="form-control" id="nickname" placeholder="昵称(必填">
                            </div>
                            <div class="form-group">
                                <input type="email" class="form-control" id="email" placeholder="邮箱(必填)">
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control" id="web" placeholder="个人网站(可选)">
                            </div>
                            <button type="submit" class="btn btn-default">发布</button>
                        </div>
                    </div>
                    <volist name="list" id="row">
                        <article class="post twitter-post">
                            <div class="message-content clearfix">
                                <div class="message-head">
                                    <if condition="$row['uid'] eq 1">
                                        <img src="__ROOT__/Uploads/{$web['logo']}" class="img-circle">
                                        <else />
                                        <img src="{$row['head']}" class="img-circle">
                                    </if>
                                </div>
                                <div class="post-footer clearfix">
                                    <div class="pull-left">
                                    <span class="message-icon">
                                        <i class="fa fa-user"></i>
                                        <if condition="$row['web_url'] neq ''">
                                            <a href="{$row['web_url']}" target="_blank">{$row['nickname']}</a>
                                            <else />
                                            {$row['nickname']}
                                        </if>
                                    </span>&nbsp;
                                        <time class="message-icon" title="{$row['create_time']}">
                                            <i class="fa fa-clock-o"></i>
                                            {$row['create_time']}
                                        </time>&nbsp;
                                    <span class="message-icon">
                                        <i class="fa fa-map-marker"></i>
                                        {$row['province']} · {$row['city']}
                                    </span>
                                    </div>
                                </div>
                                <div class="post-content ">
                                    <p>{$row['content']}</p>
                                </div>
                            </div>
                            <if condition="!empty($row['reply'])">
                                <div class="hr">
                                    <hr>
                                    <div class="message-reply">
                                        <div class="message-head">
                                            <img src="__ROOT__/Uploads/{$web['logo']}" class="img-circle">
                                        </div>
                                        <div class="post-footer clearfix">
                                            <div class="pull-left">
                                                <span class="message-icon">
                                                    <i class="fa fa-user"></i>
                                                    {$row['reply']['nickname']}
                                                </span>&nbsp;
                                                <time class="message-icon" title="{$row['create_time']}">
                                                    <i class="fa fa-clock-o"></i>
                                                    {$row['reply']['create_time']}
                                                </time>&nbsp;
                                                <span class="">
                                                    回复 @{$row['reply']['p_name']}
                                                </span>&nbsp;
                                            </div>
                                        </div>
                                        <div class="post-content ">
                                            <p>{$row['reply']['content']}</p>
                                        </div>
                                    </div>
                                </div>
                            </if>
                        </article>
                    </volist>
                </main>
            </div>
            <nav class="pagination" role="navigation">
                {$page}
            </nav>
        </div>
    </section>
</block>
<block name="script">
    <script>
        $('.btn').click(function(){
            var nickname = $('#nickname').val(),
                    email = $('#email').val(),
                    web = $('#web').val(),
                    content = $('#content').val();
            if(content == ''){
                alert('内容不能为空!');
            }else if(nickname == ''){
                alert('昵称不能为空!');
            }else if(email == ''){
                alert('邮箱不能为空!');
            }else{
                $.ajax({
                    url:'{:U("Message/post")}',
                    type:'POST',
                    data:{nickname:nickname,email:email,web:web,content:content},
                    success:function(data){
                        if(data.status){
                            alert('留言成功！');
                        }else{
                            alert(data.info);
                        }
                    }
                });
            }
        });
    </script>
</block>


